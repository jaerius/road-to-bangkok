### Solidity의 View 및 Pure Function

## 목표
- Solidity에서 view와 pure 함수의 개념과 사용법을 학습한다.
- view와 pure 함수의 차이점을 이해하고, 상태를 변경하지 않는 함수의 중요성을 인식한다.
- 제공된 예제 코드를 Remix IDE에서 작성하고 실행하여 view와 pure 함수의 동작을 확인한다.
- view와 pure 함수를 통해 가스비를 절감할 수 있는 방법을 이해한다.
<br>
Solidity에서 함수는 상태를 변경할 수 있는지 여부에 따라 `view`와 `pure`로 구분할 수 있다.
이 두 가지 함수 타입은 스마트 계약의 상태를 안전하게 관리하고, 상태를 변경하지 않도록 보장하며 가스비를 줄이는데 매우 유용하다.

### View 함수

**`view` 함수**는 상태 변수를 읽을 수 있지만, 상태를 변경할 수 없음을 명시적으로 보장하는 함수다.

- **특징**:
    - 상태 변수의 값을 읽을 수 있다.
    - 상태를 변경하는 연산은 수행할 수 없다.
    - 상태를 변경하는 함수 호출도 불가능하다.
- **예제**:
  ```solidity
  // SPDX-License-Identifier: MIT
  pragma solidity ^0.8.24;

  contract ViewExample {
      uint256 public x = 1;

      // 상태를 변경하지 않음을 보장하는 함수
      function addToX(uint256 y) public view returns (uint256) {
          return x + y;
      }
  }
  ```
  위 예제에서 `addToX` 함수는 상태 변수 `x`를 읽어서 `y`와 더한 값을 반환한다. 이 함수는 상태를 변경하지 않음을 보장하므로 `view`로 선언되었다.
  
### Pure 함수

**`pure` 함수**는 상태 변수를 읽거나 변경하지 않음을 명시적으로 보장하는 함수다.

- **특징**:
    - 상태 변수를 읽거나 변경할 수 없다.
    - 블록체인 상의 상태에 의존하지 않는 계산을 수행한다.
    - 주어진 인자만을 사용하여 결과를 반환한다.
- **예제**:
  ```solidity
  // SPDX-License-Identifier: MIT
  pragma solidity ^0.8.24;

  contract PureExample {
      // 상태를 읽거나 변경하지 않음을 보장하는 함수
      function add(uint256 i, uint256 j) public pure returns (uint256) {
          return i + j;
      }
  }
  ```
  위 예제에서 `add` 함수는 두 입력 값 `i`와 `j`를 더한 결과를 반환한다. 이 함수는 상태 변수에 의존하지 않으며, 상태를 변경하지 않기 때문에 `pure`로 선언되었다.

### View와 Pure 함수의 차이점

- **View 함수**: 상태 변수를 읽을 수 있지만, 상태를 변경하지 않는다.
    - 예: 상태 변수를 읽어서 값을 계산하거나 반환하는 함수
    - `function viewFunction() public view returns (uint256)`

- **Pure 함수**: 상태 변수를 읽거나 변경하지 않는다.
    - 예: 함수의 입력 값만을 사용하여 계산을 수행하는 함수
    - `function pureFunction(uint256 a, uint256 b) public pure returns (uint256)`

### View와 Pure 함수의 가스비

`view`와 `pure` 함수는 Solidity에서 가스비 절감을 위해 중요하다.
상태를 읽거나 변경하지 않도록 제한함으로써, 트랜잭션 수수료를 최소화하고, 효율적인 스마트 계약을 개발할 수 있다.

#### `view` 함수

`view` 함수는 상태 변수를 읽을 수 있지만, 변경할 수는 없다. 이러한 함수는 블록체인 상태를 변경하지 않기 때문에 트랜잭션을 발생시키지 않는다. 따라서, 호출할 때 가스비가 들지 않는다.
  - `view` 함수는 상태를 읽기만 하기 때문에 트랜잭션 수수료(가스비)를 절약할 수 있다.
  - 외부에서 호출할 경우, 노드에 데이터를 요청하여 결과를 즉시 받을 수 있고, 트랜잭션이 발생하지 않으므로 가스비가 들지 않는다.

#### `pure` 함수

`pure` 함수는 상태 변수뿐만 아니라 블록체인의 상태를 전혀 읽지 않는다. 즉, 함수 내에서 상태 변수나 블록 데이터에 접근하지 않고 오직 입력값만을 가지고 계산을 수행한다.

  - `pure` 함수는 블록체인 상태에 전혀 영향을 주지 않기 때문에 외부 호출 시 가스비가 들지 않는다.
  - 블록체인 데이터에 접근하지 않으므로 연산 비용만 필요하다.

#### 가스비 절감 효과

1. **트랜잭션 생성과 가스비**:
  - 상태를 변경하는 함수는 트랜잭션을 발생시키고, 이를 블록에 기록하는데 가스비가 필요하다. 반면, `view`와 `pure` 함수는 상태를 변경하지 않기 때문에 가스비가 발생하지 않는다.

2. **외부 호출 (외부에서 호출 시)**:
  - `view`와 `pure` 함수는 외부에서 호출될 때 EVM을 실행하지 않으므로 가스비가 들지 않는다. 이는 개발자가 데이터를 확인하거나 계산을 수행할 때 유용하다.

3. **내부 호출 (계약 내에서 호출 시)**:
  - 계약 내에서 호출될 때는 `view` 함수는 읽기 연산에 대한 가스비가 발생하지만, 상태를 변경하지 않기 때문에 여전히 저렴하다. `pure` 함수는 상태를 전혀 읽지 않으므로 거의 비용이 들지 않는다.

#### 가스비 절감 예시

1. **데이터 조회**:
  - 예를 들어, 사용자 잔고 조회, 특정 상태 확인 등 데이터 조회 시 `view` 함수를 사용하면 가스비를 절약할 수 있다.

2. **계산 함수**:
  - 단순히 입력 값을 바탕으로 계산을 수행하는 함수는 `pure`로 정의하여 가스비를 줄일 수 있다.

### 예제 코드

전체 예제 코드는 다음과 같다:

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.24;

contract ViewAndPure {
    uint256 public x = 1;

    // 상태를 변경하지 않음을 보장하는 함수
    function addToX(uint256 y) public view returns (uint256) {
        return x + y;
    }

    // 상태를 읽거나 변경하지 않음을 보장하는 함수
    function add(uint256 i, uint256 j) public pure returns (uint256) {
        return i + j;
    }
}
```

이 예제는 두 가지 타입의 함수를 포함하고 있으며, 각 함수가 상태를 어떻게 다루는지 보여준다. `addToX` 함수는 `view` 함수로, 상태 변수 `x`를 읽어서 사용하고 있으며, `add` 함수는 `pure` 함수로, 상태 변수와는 무관한 계산을 수행한다.

### 예제 코드 설명

이 예제는 `view`와 `pure` 함수의 사용법을 보여주는 간단한 스마트 계약이다.
두 가지 함수 모두 상태를 변경하지 않으며, 각기 다른 방식으로 상태와 상호작용하지 않음을 보장한다.

##### 상태 변수

- `uint256 public x = 1;`
    - `x`는 상태 변수로, 스마트 계약의 저장소에 저장된다.
    - `public` 키워드를 사용하여 이 변수는 외부에서 읽을 수 있다.
    - 초기 값은 `1`로 설정되어 있다.

##### `view` 함수: `addToX`

- `function addToX(uint256 y) public view returns (uint256)`
    - 이 함수는 하나의 인자 `y`를 입력받는다.
    - `view` 키워드는 이 함수가 상태 변수를 읽을 수 있지만, 변경할 수 없음을 보장한다.
    - 함수는 상태 변수 `x`의 값과 입력받은 값 `y`를 더한 결과를 반환한다.
    - 예를 들어, `addToX(5)`를 호출하면 `x`는 `1`이고 `y`는 `5`이므로, 반환 값은 `1 + 5 = 6`이다.

##### `pure` 함수: `add`

- `function add(uint256 i, uint256 j) public pure returns (uint256)`
    - 이 함수는 두 개의 인자 `i`와 `j`를 입력받는다.
    - `pure` 키워드는 이 함수가 상태 변수를 읽거나 변경하지 않음을 보장한다.
    - 함수는 입력받은 두 값 `i`와 `j`를 더한 결과를 반환한다.
    - 예를 들어, `add(3, 4)`를 호출하면 반환 값은 `3 + 4 = 7`이다.

### Remix 실습

1. [Remix IDE](https://remix.ethereum.org/)에 접속한다.
2. 새 파일을 만들어 위 예제 코드를 복사하여 붙여넣고 파일을 저장한다.
3. 좌측 메뉴에서 "Solidity 컴파일러"를 이용해 코드를 컴파일하고, Deploy한다.

##### 기능확인

- **초기 상태 확인**
    - 배포 직후, `x` 변수가 1로 초기화되어 있는지 확인한다.
    - `x` 변수가 `1`인지 확인하려면 `x` 버튼을 클릭하여 값을 확인한다.

- **view 함수 테스트 (`addToX`)**
    - `addToX` 함수에 임의의 값 (예: 5)을 입력하고 호출한다.
    - `addToX(5)` 버튼을 클릭하여 반환값이 `6`(1+5)인지 확인한다.
    - `x` 값이 변경되지 않았는지 확인한다.

- **pure 함수 테스트 (`add`)**
    - `add` 함수에 두 개의 임의의 값 (예: 3과 4)을 입력하고 호출한다.
    - `add(3, 4)` 버튼을 클릭하여 반환값이 `7`(3+4)인지 확인한다.

![image](https://github.com/Joon2000/Solidity-modules/assets/69339099/2e61c307-721e-4112-ad01-12781827767a)
